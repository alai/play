<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#e9d8d1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Misudoku" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Misudoku</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon-180.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app" id="appRoot">
    <header class="app-header">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true">Mi</div>
        <div class="brand-text">
          <h1>Misudoku</h1>
          <p>在安静里练习专注</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="ghost icon-btn" id="puzzleBtn" type="button" aria-label="题目">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4.5 5.5a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v13.5a1 1 0 0 1-1.6.8l-2.4-1.8-2.4 1.8a1 1 0 0 1-1.2 0l-2.4-1.8-2.4 1.8a1 1 0 0 1-1.6-.8z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
            <path d="M8 7.5h8M8 10.5h8M8 13.5h6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
          </svg>
        </button>
        <button class="ghost icon-btn" id="settingsBtn" type="button" aria-label="设置">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 15.2a3.2 3.2 0 1 0 0-6.4 3.2 3.2 0 0 0 0 6.4z" fill="none" stroke="currentColor" stroke-width="1.6" />
            <path d="M19.4 12a7.4 7.4 0 0 0-.1-1.2l2-1.5-2-3.5-2.4 1a7.9 7.9 0 0 0-2-1.1L14.4 3h-4.8l-.5 2.7a7.9 7.9 0 0 0-2 1.1l-2.4-1-2 3.5 2 1.5a7.4 7.4 0 0 0 0 2.4l-2 1.5 2 3.5 2.4-1a7.9 7.9 0 0 0 2 1.1l.5 2.7h4.8l.5-2.7a7.9 7.9 0 0 0 2-1.1l2.4 1 2-3.5-2-1.5c.1-.4.1-.8.1-1.2z" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round" />
          </svg>
        </button>
        <button class="ghost icon-btn" id="themeToggle" type="button" aria-label="切换日间/夜间">
          <svg class="icon icon-moon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20 15.2A7.8 7.8 0 0 1 8.8 4a8.5 8.5 0 1 0 11.2 11.2z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
          </svg>
          <svg class="icon icon-sun" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="1.6" />
            <path d="M12 2.5v2.5M12 19v2.5M4.6 4.6l1.8 1.8M17.6 17.6l1.8 1.8M2.5 12h2.5M19 12h2.5M4.6 19.4l1.8-1.8M17.6 6.4l1.8-1.8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
          </svg>
        </button>
      </div>
    </header>

    <section class="board-card">
      <div class="board" id="board" role="grid" aria-label="Sudoku 棋盘"></div>
    </section>

    <section class="keypad" aria-label="数字输入">
      <button class="key" data-key="1" type="button">1</button>
      <button class="key" data-key="2" type="button">2</button>
      <button class="key" data-key="3" type="button">3</button>
      <button class="key" data-key="4" type="button">4</button>
      <button class="key" data-key="5" type="button">5</button>
      <button class="key" data-key="6" type="button">6</button>
      <button class="key" data-key="7" type="button">7</button>
      <button class="key" data-key="8" type="button">8</button>
      <button class="key" data-key="9" type="button">9</button>
      <button class="key" data-key="clear" type="button" aria-label="清除">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4.5 6.5h10l5 5-5 5h-10l-3.5-5z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" />
          <path d="M9 9l6 6M15 9l-6 6" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
        </svg>
      </button>
    </section>

    <section class="controls">
      <div class="control-row">
        <button class="pill" id="noteToggle" type="button">笔记</button>
        <button class="pill" id="undoBtn" type="button">撤销</button>
        <button class="pill" id="conflictToggle" type="button">冲突提示</button>
        <button class="pill" id="pauseBtn" type="button">暂停</button>
      </div>
    </section>
  </div>

  <dialog class="modal" id="puzzleDialog">
    <div class="modal-header">
      <h2>题目</h2>
      <button class="ghost" id="closePuzzle" type="button">关闭</button>
    </div>
    <div class="modal-body">
      <div class="modal-section">
        <div class="section-header">
          <h3>状态</h3>
          <button class="ghost" id="resetPuzzleBtn" type="button">重置本题</button>
        </div>
        <div class="settings-grid">
          <div class="settings-item">
            <div class="label">当前题目</div>
            <div class="value" id="puzzleMeta">未开始</div>
          </div>
          <div class="settings-item">
            <div class="label">当前计时</div>
            <div class="value" id="timer">00:00</div>
          </div>
          <div class="settings-item">
            <div class="label">当前尝试</div>
            <div class="value" id="attempts">0</div>
          </div>
        </div>
      </div>
      <div class="modal-section">
        <div class="section-header">
          <h3>题库</h3>
          <button class="ghost" id="toggleImportExport" type="button">导入/导出</button>
        </div>
        <div class="segmented" id="sourceSeg">
          <button type="button" class="segmented-btn is-active" data-source="book">书籍题库</button>
          <button type="button" class="segmented-btn" data-source="generated">生成题</button>
        </div>
        <div class="library-content">
          <div id="bookPanel">
            <div class="book-list" id="bookList"></div>
            <div class="list-footer">
              <button class="pill" id="selectPuzzleBtn" type="button" disabled>选这题</button>
            </div>
          </div>
          <div id="importExportPanel" hidden>
            <div class="modal-section nested">
              <h3>导入题库 / 进度</h3>
              <p class="hint">支持 JSON 或 CSV。JSON 可包含题库与进度，CSV 仅导入题库。</p>
              <input id="importFile" type="file" accept=".json,.csv,application/json,text/csv" />
              <div class="inline">
                <label class="switch">
                  <input type="checkbox" id="replaceMode" />
                  <span>替换现有数据</span>
                </label>
                <button class="pill" id="importBtn" type="button">开始导入</button>
                <button class="pill" id="downloadTemplateBtn" type="button">下载模板</button>
              </div>
              <div class="status" id="importStatus"></div>
            </div>
            <div class="modal-section nested">
              <h3>导出备份</h3>
              <p class="hint">包含题库、进度与设置，用于重装后恢复。</p>
              <button class="pill" id="exportBtn" type="button">下载备份 JSON</button>
            </div>
          </div>
          <div id="generatedPanel" hidden>
            <div class="modal-section nested">
              <h3>生成题</h3>
              <p class="hint">生成题操作区待设计。</p>
            </div>
            <div class="modal-section nested" id="generatedDifficultyRow" hidden>
              <div class="label">生成难度</div>
              <div class="segmented" id="genDifficulty">
                <button type="button" class="segmented-btn is-active" data-gen="1">简单</button>
                <button type="button" class="segmented-btn" data-gen="2">中等</button>
                <button type="button" class="segmented-btn" data-gen="3">困难</button>
                <button type="button" class="segmented-btn" data-gen="4">专家</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <dialog class="modal" id="settingsDialog">
    <div class="modal-header">
      <h2>设置</h2>
      <button class="ghost" id="saveSettingsBtn" type="button">保存设置</button>
    </div>
    <div class="modal-body">
      <div class="modal-section">
        <div class="pref-row">
          <div>
            <h3>填数提示高亮</h3>
            <p class="hint">点亮选中格所在的行、列、宫</p>
          </div>
          <label class="switch">
            <input type="checkbox" id="relatedHighlightToggle" />
            <span>开启</span>
          </label>
        </div>
      </div>
      <div class="modal-section">
        <div class="pref-row">
          <div>
            <h3>同数字高亮</h3>
            <p class="hint">点亮所有与填入数相同的数字</p>
          </div>
          <label class="switch">
            <input type="checkbox" id="sameDigitHighlightToggle" />
            <span>开启</span>
          </label>
        </div>
      </div>
      <div class="modal-section">
        <h3>欢庆效果</h3>
        <div class="segmented" id="celebrationThemeSeg">
          <button type="button" class="segmented-btn is-active" data-celebration="zen">Zen</button>
          <button type="button" class="segmented-btn" data-celebration="default">Default</button>
          <button type="button" class="segmented-btn" data-celebration="festival">Festival</button>
        </div>
      </div>
    </div>
  </dialog>

  <dialog class="modal" id="confirmResetDialog">
    <div class="modal-body center">
      <h2>重置本题</h2>
      <p class="hint">当前记录将被清除，是否重置？</p>
      <div class="inline center">
        <button class="pill" id="confirmResetBtn" type="button">是</button>
        <button class="ghost" id="cancelResetBtn" type="button">否</button>
      </div>
    </div>
  </dialog>

  <dialog class="modal" id="winDialog">
    <div class="modal-body center">
      <h2>完成</h2>
      <p id="winSummary">你已经完成这道题。</p>
      <div class="inline center">
        <button class="pill" id="winNextBtn" type="button">下一题</button>
        <button class="ghost" id="winCloseBtn" type="button">关闭</button>
      </div>
    </div>
  </dialog>

  <script src="celebration-fx.js"></script>
  <script src="app.js"></script>
</body>
</html>
